---
up: [[Общие вопросы]]
---
# Строки
---
### Какие нюансы у строк в Java?
Класс `String` в Java - неизменяемый из-за модификатора `final` и отсутствия сеттера. Это нужно для реализации пула стрингов. При редактировании будет создаваться новая строка. При копировании новая строка не создается, а создается ссылка на существующую строку.

### Какая основная разница между `String`, `StringBuffer`, `StringBuilder`?
`String` - неизменяемый, потокобезопасный;
`StringBuffer` - изменяемый, потокобезопасный;
`StringBuilder` - изменяемый, потоко**не**безопасный.

### Что означает иммутабельность строк?
Все внутренние поля класса `String` являются `private` и `final`, для которых отсутствуют сеттеры, а значит объект класса `String` нельзя изменить.

### Почему `String` неизменяемый и финализированный класс?
Есть несколько преимуществ в неизменности строк:

• Пул строк возможен только потому, что строка неизменяемая, таким образом виртуальная машина сохраняет больше свободного места в Heap, поскольку разные строковые переменные указывают на одну и ту же переменную в пуле. Если бы строка была изменяемой, то интернирование строк не было бы возможным, потому что изменение значения одной переменной отразилось бы также и на остальных переменных, ссылающихся на эту строку.
• Если строка будет изменяемой, тогда это станет серьезной угрозой безопасности приложения. Например, имя пользователя базы данных и пароль передаются строкой для получения соединения с базой данных и в программировании сокетов реквизиты хоста и порта передаются строкой. Так как строка неизменяемая, её значение не может быть изменено, в противном случае злоумышленник может изменить значение ссылки и вызвать проблемы в безопасности приложения.
• Неизменяемость позволяет избежать синхронизации: строки безопасны для многопоточности и один экземпляр строки может быть совместно использован различными потоками.
• Строки используются `classloader` и неизменность обеспечивает правильность загрузки класса.
• Поскольку строка неизменяемая, её `hashCode()` кэшируется в момент создания и нет необходимости рассчитывать его снова. Это делает строку отличным кандидатом для ключа в HashMap т.к. его обработка происходит быстрее.

### Как реализовать свой Immutable тип данных?
1) `private final` поля
2) Отсутствие сеттеров
3) `final class` (чтобы от него не могли наследоваться) и переопределять методы
4) Не возвращать из методов изменяемые объекты, а только их клоны

### Что такое пул строк?
Область памяти где хранятся обьекты строк. 
При создании в пуле идет поиск строки:
- если НЕ находит -  создается строка, возращается ссылка
- если находит - возращает ссылку найденной строки.

При этом использование оператора `new` заставляет класс `String` создать новый объект, даже если такая строка уже есть в пуле. После этого можем использовать метод `intern()`, чтобы поместить этот объект в пул строк.

### Что делает метод `intern()` в классе `String`?
Помещает строку в pool строк.

### Почему строка является популярным ключом в `HashMap` в Java?
Поскольку строки неизменны, их хэшкод кэшируется в момент создания, и не требует повторного пересчета.

### Почему не рекомендуется изменять строки в цикле? Что рекомендуется использовать?
Т.к. строка неизменяемый класс, потребление ресурсов при редактировании, т.к. каждую итерацию при редактировании будет создаваться новый обьект строки. Рекомендуется использовать `StringBuilder` или `StringBuffer`.

### Почему строки не рекомендуется использовать для хранения паролей?
1. **Пул строк**  
Так как строки в Java хранятся в пуле строк, то ваш пароль в виде обычного текста будет доступен в памяти, пока сборщик мусора не очистит её. И поскольку `String` используются в String pool для повторного использования, существует довольно высокая вероятность того, что пароль останется в памяти надолго, что совсем не безопасно.  
  
2. **Рекомендации авторов**  
Java сама по себе рекомендует использовать метод `getPassword()` из класса `JPasswordField`, который возвращает `char[]`.  
  
3. **Случайная печать в логах**
С типом `String` всегда существует опасность того, что текст, хранящийся в строке будет напечатан в файле логов или в консоли. В то же время в случае использования Array, вы не будете печатать содержимое массива, а только его расположение в памяти.

### Можно ли использовать строки в конструкции switch?
Да, начиная с Java 7 в операторе switch можно использовать строки, ранние версии Java не поддерживают этого.
При этом:
* участвующие строки чувствительны к регистру;
* использование строк в конструкции switch делает код читабельнее, убирая множественные цепи условий if-else
* оператор switch использует метод String.equals() для сравнения полученного значения со значениями case, поэтому добавьте проверку на NULL во избежание NullPointerException.

[Подробнее на JavaRush (10 вопрос)](https://javarush.ru/groups/posts/759-java-string-voprosih-k-sobesedovaniju-i-otvetih-na-nikh-ch1)
